---
interface Props {
  price: {
    original: number
    discount: number
    savings: number
  }
  mercadoPagoLink: string
  preferenceId: string
  paypalLink: string
}

const { price, mercadoPagoLink, preferenceId, paypalLink } = Astro.props
---

<section
  id="precio"
  class="bg-gradient-to-br from-pink-600 to-purple-700 py-16"
>
  <div class="mx-auto max-w-4xl px-4 text-center sm:px-6 lg:px-8">
    <h2 class="mb-4 text-3xl font-bold text-white md:text-4xl">
      ¡Transforma Tu Pasión en Profesión HOY!
    </h2>
    <p class="mb-8 text-xl text-white/90">
      Únete a cientos de estudiantes que ya están creando arte increíble y
      generando ingresos
    </p>

    <!-- Pricing Box -->
    <div class="mb-8 rounded-2xl bg-white/10 p-8 backdrop-blur-sm">
      <div class="mb-6">
        <p class="text-lg text-white/70">Precio normal del curso:</p>
        <p class="text-xl text-white/70 line-through">
          ${price.original} MXN
        </p>
      </div>

      <div class="mb-8 rounded-xl bg-yellow-400 p-4">
        <p class="text-lg font-bold text-yellow-900">
          🔥 PRECIO ESPECIAL HOY:
        </p>
        <p class="text-5xl font-black text-yellow-900">
          ${price.discount} MXN
        </p>
        <p class="font-bold text-yellow-900">Ahorras $300 MXN</p>
      </div>

      <!-- Payment Options -->
      <div class="mb-6 grid grid-cols-1 gap-6 md:grid-cols-2">
        <!-- Mercado Pago - México -->
        <div class="rounded-lg bg-white/20 p-6 backdrop-blur-sm">
          <div class="mb-4">
            <h3 class="mb-2 text-xl font-bold text-white">🇲🇽 Para México</h3>
            <p class="text-sm text-white/80">Mercado Pago • MSI • OXXO</p>
          </div>
          <script
            src={mercadoPagoLink}
            data-preference-id={preferenceId}
            data-source="button"></script>
          <div class="mt-3 space-y-1 text-xs text-white/70">
            <p>💳 12 meses sin intereses</p>
            <p>🏪 Pago en tiendas OXXO</p>
            <p>🏦 Transferencia bancaria</p>
          </div>
        </div>

        <!-- PayPal - Internacional -->
        <div class="rounded-lg bg-white/20 p-6 backdrop-blur-sm">
          <div class="mb-4">
            <h3 class="mb-2 text-xl font-bold text-white">
              🌍 Internacional
            </h3>
            <p class="text-sm text-white/80">PayPal • $65 USD</p>
          </div>
          <div id="paypal-button-container" class="mb-3"></div>
          <div class="mt-3 space-y-1 text-xs text-white/70">
            <p>💳 Tarjetas internacionales</p>
            <p>🌍 Disponible globalmente</p>
            <p>💱 Pago en USD</p>
          </div>
        </div>
      </div>

      <div class="text-center">
        <p class="text-sm font-medium text-white/80">
          🔒 Transacciones 100% seguras y encriptadas
        </p>
      </div>
    </div>

    <!-- Investment Summary -->
    <div class="rounded-xl bg-white/20 p-6 backdrop-blur-sm">
      <h3 class="mb-4 text-xl font-bold text-white">
        Resumen de tu inversión:
      </h3>
      <div
        class="grid grid-cols-1 gap-3 text-sm text-white/90 md:grid-cols-2"
      >
        <div class="text-left">
          <p>✅ Curso completo de caricatura (8 semanas)</p>
          <p>✅ 5 caricaturas paso a paso</p>
          <p>✅ 3 bonos premium (valor $1,050)</p>
        </div>
        <div class="text-left">
          <p>✅ Asesoría personalizada</p>
          <p>✅ Comunidad exclusiva</p>
          <p>✅ Garantía de satisfacción</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- PayPal SDK -->
<script
  src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=USD"
></script>

<script>
  // Declare PayPal types
  declare const paypal: any

  // PayPal Button Initialization
  if (typeof paypal !== 'undefined') {
    paypal
      .Buttons({
        createOrder: function (data: any, actions: any) {
          return actions.order.create({
            purchase_units: [
              {
                amount: {
                  value: '65.00',
                  currency_code: 'USD',
                },
                description: 'Curso Online de Caricatura - Nivel Básico I',
              },
            ],
          })
        },
        onApprove: function (data: any, actions: any) {
          return actions.order.capture().then(function (details: any) {
            alert('¡Pago completado! Revisa tu email para acceder al curso.')
            window.location.href = '/success'
          })
        },
        onError: function (err: any) {
          console.error('PayPal Error:', err)
          alert('Hubo un error con el pago. Por favor intenta de nuevo.')
        },
      })
      .render('#paypal-button-container')
  }

  // Smooth scroll for anchor links
  document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
    anchor.addEventListener('click', function (this: HTMLAnchorElement, e) {
      e.preventDefault()
      const href = this.getAttribute('href')
      const target = href ? document.querySelector(href) : null
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start',
        })
      }
    })
  })
</script>