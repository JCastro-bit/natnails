---
interface Props {
  price: {
    original: number
    discount: number
    savings: number
  }
  mercadoPagoLink: string
  preferenceId: string
  paypalLink: string
  paypalClientId?: string
  paypalAmountUSD?: string
  paypalCurrency?: string
}

const {
  price,
  mercadoPagoLink,
  preferenceId,
  paypalClientId,
  paypalAmountUSD = '65.00',
  paypalCurrency = 'USD',
} = Astro.props
---

<section
  id="precio"
  class="bg-gradient-to-br from-pink-600 to-purple-700 py-16"
>
  <div class="mx-auto max-w-4xl px-4 text-center sm:px-6 lg:px-8">
    <!-- Urgencia y titular -->
    <div class="mb-8">
      <div
        class="mb-4 inline-block rounded-full bg-yellow-400 px-6 py-3 text-lg font-bold text-black"
      >
        üî• OFERTA TERMINA HOY A MEDIANOCHE
      </div>
      <h2 class="mb-4 text-3xl font-bold text-white md:text-4xl">
        ¬°Inscr√≠bete Ahora y Ahorra $300!
      </h2>
      <p class="text-xl text-white/90">
        M√°s de 500 alumnas ya transformaron su pasi√≥n en una fuente de ingresos
      </p>
    </div>

    <!-- Pricing Box Principal -->
    <div class="mb-8 rounded-3xl bg-white p-8 shadow-2xl">
      <div class="mb-8 text-center">
        <div class="mb-4">
          <span class="text-lg text-gray-500 line-through"
            >Precio regular: ${price.original} MXN</span
          >
        </div>

        <div
          class="mb-6 rounded-2xl bg-gradient-to-r from-green-400 to-green-600 p-6"
        >
          <p class="mb-2 text-2xl font-bold text-white">
            üéâ PRECIO ESPECIAL HOY
          </p>
          <p class="text-6xl font-black text-white">${price.discount}</p>
          <p class="text-xl font-bold text-white">
            ¬°Ahorras ${price.savings} MXN!
          </p>
        </div>

        <!-- Lo que incluye -->
        <div class="mb-8 rounded-xl bg-gray-50 p-6">
          <h3 class="mb-4 text-xl font-bold text-gray-900">
            Todo lo que recibes por ${price.discount}:
          </h3>
          <div class="grid grid-cols-1 gap-3 text-left md:grid-cols-2">
            <div class="flex items-center">
              <span class="mr-2 text-green-600">‚úì</span>
              <span class="text-gray-700">8 semanas de curso completo</span>
            </div>
            <div class="flex items-center">
              <span class="mr-2 text-green-600">‚úì</span>
              <span class="text-gray-700">Asesor√≠a personalizada 1 a 1</span>
            </div>
            <div class="flex items-center">
              <span class="mr-2 text-green-600">‚úì</span>
              <span class="text-gray-700">5 caricaturas paso a paso</span>
            </div>
            <div class="flex items-center">
              <span class="mr-2 text-green-600">‚úì</span>
              <span class="text-gray-700">T√©cnicas de relieves 3D</span>
            </div>
            <div class="flex items-center">
              <span class="mr-2 text-green-600">‚úì</span>
              <span class="text-gray-700">Comunidad privada en Telegram</span>
            </div>
            <div class="flex items-center">
              <span class="mr-2 text-green-600">‚úì</span>
              <span class="text-gray-700">Garant√≠a de 7 d√≠as</span>
            </div>
          </div>
        </div>

        <!-- Valor real -->
        <div class="mb-6 rounded-xl bg-blue-50 p-4">
          <p class="font-bold text-blue-800">
            üíé Valor real del curso: $3,500+ MXN<br />
            <span class="text-sm font-normal"
              >Comparado con cursos presenciales similares</span
            >
          </p>
        </div>
      </div>

      <!-- Opciones de Pago Mejoradas -->
      <div class="mb-8 grid grid-cols-1 gap-6 md:grid-cols-2">
        <!-- Mercado Pago - M√©xico -->
        <div
          class="rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 p-6 text-white"
        >
          <h4 class="mb-3 text-lg font-bold">üá≤üáΩ Pago con Mercado Pago</h4>
          <p class="mb-4 text-sm text-blue-100">
            Tarjeta de cr√©dito, d√©bito, OXXO, transferencia
          </p>
          <!-- Bot√≥n oficial de Mercado Pago (embed) -->
          <div class="cho-container">
            <script
              is:inline
              src={mercadoPagoLink}
              data-preference-id={preferenceId}
              data-source="button"></script>
          </div>
          <p class="mt-2 text-xs text-blue-200">
            Hasta 12 meses sin intereses con algunas tarjetas
          </p>
        </div>

        <!-- PayPal Internacional -->
        <div
          class="rounded-xl bg-gradient-to-br from-purple-500 to-purple-600 p-6 text-white"
        >
          <h4 class="mb-3 text-lg font-bold">üåç Pago Internacional</h4>
          <p class="mb-4 text-sm text-purple-100">
            PayPal, tarjetas internacionales
          </p>
          {
            paypalClientId ? (
              <>
                <div id="paypal-button-container" />
                <p class="mt-2 text-xs text-purple-200">
                  Conversi√≥n autom√°tica a tu moneda local
                </p>
              </>
            ) : (
              <>
                <button
                  disabled
                  class="block w-full cursor-not-allowed rounded-lg bg-white/40 py-3 text-center font-bold text-white opacity-70"
                >
                  Pr√≥ximamente
                </button>
                <p class="mt-2 text-xs text-purple-200">
                  Este m√©todo estar√° disponible pronto
                </p>
              </>
            )
          }
        </div>
      </div>

      <!-- Informaci√≥n adicional -->
      <div class="border-t pt-6">
        <div
          class="mb-4 flex items-center justify-center space-x-4 text-sm text-gray-600"
        >
          <div class="flex items-center">
            <svg
              class="mr-1 h-4 w-4 text-green-600"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                clip-rule="evenodd"></path>
            </svg>
            Pago 100% seguro
          </div>
          <div class="flex items-center">
            <svg
              class="mr-1 h-4 w-4 text-green-600"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                clip-rule="evenodd"></path>
            </svg>
            Acceso inmediato
          </div>
          <div class="flex items-center">
            <svg
              class="mr-1 h-4 w-4 text-green-600"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                clip-rule="evenodd"></path>
            </svg>
            Garant√≠a de 7 d√≠as
          </div>
        </div>

        <p class="text-sm text-gray-500">
          üí° <strong>Tip:</strong> Despu√©s del pago recibir√°s un email con el enlace
          al grupo de Telegram donde comenzar√° tu transformaci√≥n.
        </p>
      </div>
    </div>

    <!-- Urgencia final -->
    <div class="rounded-xl bg-red-600 p-6 text-white">
      <h3 class="mb-2 text-xl font-bold">‚è∞ Esta oferta expira en:</h3>
      <div id="countdown" class="mb-3 text-3xl font-bold">23:59:42</div>
      <p class="text-red-100">
        No pierdas la oportunidad de ahorrar ${price.savings} MXN y cambiar tu vida
        para siempre
      </p>
    </div>
  </div>
</section>

<!-- Countdown y helpers -->
<script is:inline>
  // Countdown timer
  function updateCountdown() {
    const now = new Date().getTime()
    const tomorrow = new Date()
    tomorrow.setDate(tomorrow.getDate() + 1)
    tomorrow.setHours(0, 0, 0, 0)
    const distance = tomorrow - now

    const hours = Math.floor(
      (distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
    )
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60))
    const seconds = Math.floor((distance % (1000 * 60)) / 1000)

    var el = document.getElementById('countdown')
    if (el) {
      el.innerHTML =
        hours.toString().padStart(2, '0') +
        ':' +
        minutes.toString().padStart(2, '0') +
        ':' +
        seconds.toString().padStart(2, '0')
    }
  }
  updateCountdown()
  setInterval(updateCountdown, 1000)

  // Smooth scroll for anchor links
  document.querySelectorAll('a[href^="#"]').forEach(function (anchor) {
    anchor.addEventListener('click', function (e) {
      e.preventDefault()
      const href = anchor.getAttribute('href')
      const target = href ? document.querySelector(href) : null
      if (target) {
        target.scrollIntoView({ behavior: 'smooth', block: 'start' })
      }
    })
  })
</script>

{
  paypalClientId && (
    <script
      src={`https://www.paypal.com/sdk/js?client-id=${paypalClientId}&currency=${paypalCurrency}`}
    />
  )
}

{
  paypalClientId && (
    <script is:inline define:vars={{ paypalAmountUSD }}>
      // PayPal Button Initialization
      if (typeof window !== 'undefined' && typeof paypal !== 'undefined') {
      paypal
        .Buttons({
        createOrder: function (_data, actions) {
          return actions.order.create({
          purchase_units: [
            {
            amount: {
              value: paypalAmountUSD,
            },
            description: 'Curso Online de Caricatura - Nivel B√°sico I',
            },
          ],
          });
        },
        onApprove: function (_data, actions) {
          return actions.order.capture().then(function (_details) {
          alert('¬°Pago completado! Revisa tu email para acceder al curso.');
          window.location.href = '/success';
          });
        },
        onError: function (err) {
          console.error('PayPal Error:', err);
          alert('Hubo un error con el pago. Por favor intenta de nuevo.');
        },
        })
        .render('#paypal-button-container');
      }
    </script>
  )
}
